# シャープの LCD, LM162AT1 研究

Made in Japan!!!

## マニュアル

ここのがスキャンされた PDF で読みづらいと思ったが、同梱されている紙面も同じくらいの可読性
だった。

https://akizukidenshi.com/goodsaffix/LM162AT1.pdf

## 付属の抵抗 100Ω

テスターを当ててみると抵抗は並列になっている。消費電力の問題かな。電流は 67mA なので 24 個
の LED は一つ当たり 3mA 以下。まあ保守的な設定かな。パッドになってるのでチップ抵抗の方が付
けやすそうだけど付属はリードタイプ

https://tinyurl.com/2cmq6ao8

並列なので耐消費電力が OK なら 1個、2個でも良いはずだ。

ただ、そもそもバックライト無しでも動作はするはず。

## ソケットかヘッダが選べる

2x7 のソケットとヘッダが付いている。一般的なヘッダの利点はブレッドボードに挿せることだけど、
2列だから挿せない。なにかアダプタが必要。それならソケットの方が良いかな。

|                  | ヘッダ        | ソケット      |
| ---              | ---           | ---           |
| ブレボに直接挿す | アダプタ必要  | アダプタ必要  |
| ケーブルで実験   | 端子が必要    | スズメッキ線切っただけでも OK | 
| 実装             | アダプタ要    | アダプタ要    |

どっちでも良いレベルだけどソケットの方がブレボで実験しやすいかな。 

## 定格

Vdd は 7V まで, VLC は Vdd+0.3V まで行けるので、コントラスト変えるのは雑にやれる。

## LiquidCrystal の HelloWorld のテスト

動く。コントラスト VLC をオープンにしてると何も映らない。5V, 3.3V 挿しても全く見えない。
GND に落とすと、今度は黒すぎる。0.5V 前後が良さそう。PWM でもデューティサイクル 20
(20/255x5=0.5V) くらいにするとムラは出るけど、まあ読める。

正面から読むときは 0.3~0.5V だけど、角度が付くに従って電圧を上げていくと見やすい。文字が読
めるぎりぎりの横からだと 1.3V くらいが丁度良い。

なるほど、ボリュームは必須なんだな。

R/W を常時 GND に落としているが、モードとしては Write only になる。なんとなくの理解だがカ
ーソル位置で DDRAM や CG RAM に書き込むことで表示するということの様だ。何を書いているのか
マイコンが知っているので、カーソル位置の文字を読む必要は無いということだろう。またビジーフ
ラッグの読み込みもできないのだが、作動時間が決まってるんだから待てば良いということなのかな。

まあとりあえず Read モードが必要になる時が来たら考えればいいか。

## コネクタ

コネクタが無いとやってられない。間違いしか起きない。

ASOBoard 側には 8P の XH コネクタで繋ぐ。LCD 側には基板に挿した 2x7P のヘッダで繋ぐ。その
基板にボリュームも載せて、バックライトの調整をできるようにする。でやはり 8P の XH コネクタ
で ASOBoard 側へ、という形にしてみよう。

で一応 [設計図](./librecad/LCD_Connector1.0.pdf) は考えてみたものの、んーと言う感じ。例え
ば ASOBoard シールド側にも XH 8P のポストを載せるわけだが、結構でかいので、それならもうボ
リュームと 2x7P のピンヘッダを付けて、直接シールドに付けられるほうがすっきりするのでは？ケ
ーブルも嵩張るし。

## 疑問

TinkerCAD でシミュレーションしてみた。配線が面倒になったので。

- lcd.print の桁丸めは実は Serial.print と同じように ``lcd.print(1.234,2)`` → 1.23 みたい
  にできるらしい。
  - https://akizukidenshi.com/goodsaffix/LM162AT1.pdf
- lcd.print でカーソル位置は末尾に移動する。普通に lcd.print で出力を繋げられる。
- カナなどを書くのに例えば「ア」を ``\xb1`` → ``10110001`` と 16進数で書いているんだ
  が ``\b10110001`` じゃ駄目だった。
  - lcd.write(0b10110001) みたいな書き方は多分 OK
    - 多分というのは TinkerCAD はキャラ表が違うみたい。文字自体は出る
  - https://mecha-norimaki.com/arduino_start_17/ 
- アナログピンは ``rs`` の宣言の中で普通に ``d4=A0`` みたいにすれば使える。

## 今後

PIC16F18323 で MCP23017 をエミュレートして LM162AT1 を I2C で動かすことに成功した。
[経緯](../PIC_as_MCP23017/)

そこでアダプタを作ることにした。
[こちら](./Adaptor.md)
