# リチウムイオン充電器の自作

Bonton で made in Japan と書かれた 18650B を入手したので、充電器を作ってみよう

# v1.0
<!-- {{{ -->
Torex の IC, 
[XC6802A42XMR-G](https://product.torexsemi.com/ja/series/xc6802)
の SOT-25 パッケージを使う。
[マルツ](https://www.marutsu.co.jp/pc/i/2585649/)
で買える。

Rsen だけど Ibat を 800mA 以下にするので 1.3k ~ 2.0k くらいで入手しやすい抵抗で。

Ibat = 1.0/Rsen * 1000 [A] なので、1.3kΩで 770mA, 2.0kΩで 500mA となる。

[回路図](./kicad/LiIonCharger1.0/LiIonCharger1.0.pdf)

[設計図](./librecad/LiIonCharger1.0.pdf)

設計図部品表

| 記号 | 品目、品番             | 個数 |
| ---  | ---                    | ---  |
| C1   | セラコン 1uF           | 1    |
| C2   | ケミコン 1uF 在庫処分  | 1    |
| D1   | LED                    | 1    |
| J1   | ターミナル 2P          | 1    |
| K1   | ユニバーサル基板 11x6P | 1    |
| R1   | 1kΩ                   | 1    |
| Rsen | 1.3k〜2kΩ             | 1    |
| S1,2 | ピンソケット 3P        | 2    |
| U1   | XC6802A42XMR-G         | 1    |
|      | DIP 化基板             | 1    |
|      | ピンヘッダ 3P          | 2    |
| X1   | XH 横型ポスト 2P       | 1    |

その他の部品

| 品目、品番     | 個数 |
| ---            | --- |
| ケーブル       | 適量 |
| フェルール 0.25 | 4  |
| ニチフ TC 1.25 | 4   |
| チップジャック | 4   |
| 18650用ボックス | 1  |
| ヒューズ  | 1 |
| XH コンタクト | 2 |

なんか電流が 200m - 600mA で揺れてるんだけど、一応動いているように見える。
![完成品1.0](./photos/LiionCharger1.0.jpg)

熱でシャットダウンしてるかも。火傷しないまでも、触ると熱い。良く分かってなかったけど、Vin
から Vbat への電圧低下は、このIC が受け持つ。つまり $`P=(V_{in}-V_{bat}) I_{bat}`$ [W] 発
生する。Ibat=0.77A, Vin=5V, Vbat=3.6V のとき 1.1W 発生する。IC 単体で許容損失は  0.25W、
40mmx40mm 基板で 0.6W だけど、実際の基板は 8mmx10mm なので、ほぼ期待できない。

動作的には Vbat>2.9V で通常充電なので、ここを基準にしないといけない。Vin-Vbat は 2.1V、な
ので流せる電流は 0.25W/2.1V = 0.119A。Rsen=10kΩで.1A となる。

10kΩに付け替えたところ 0.1A で安定した。10kΩを並列してみて Vbat=3.6V 程度だと 0.2A は安
定、0.3A は 3~5秒毎にシャットダウンという感じだった。

![1.0 10kΩ版](./photos/v1.0_10kΩ.jpg)
<!-- }}} -->

# v2.0

NiMH 充電器のときに Nch MOSFET を使ったので、今回は Pch にしてみる。

Pch MOSFET の練習。

https://tinyurl.com/23c74vbr

候補は東芝の 2SJ334。オン抵抗 29mΩは最小クラスだけど最小ではない。しかしこれより小さいの
は 300円くらいしたり表面実装用だったりする。どうせ電池の内部抵抗や電池ボックスの接触抵抗が
1Ωとかになるんだろうし、気楽に使えそうなこれでやってみようと思う。

[回路図2.0](./kicad/LiIonCharger2.0/LiIonCharger2.0.pdf)

設計はあまり最小を狙わずにコンデンサを並べる場所を十分に作った。MOS のプルアップ抵抗は必要
なら立てて入れられるように回路を掘るだけ掘っておくが、5V をマイコンと共有しているので、電
位が分からないことは無いはずなので、不要だろう。

[設計図2.0](./librecad/LiIonCharger2.0.pdf)

部品表

| 記号 | 品目、品番 | 個数 |
| ---  | ---        | ---  |
| B1   | ユニバーサル基板 13x 10P | 1 |
| C1   | セラコン 0.1uF | 1 |
| C2   | ケミコン 在庫処分 | 1 |
| C3   | ケミコン 在庫処分 | 1 |
| D1   | LED            | 1 |
| Q1   | Pch MOSFET 2SJ334 | 1 |
| R1   | 金属板抵抗 5W1Ω MPC74 | 1 |
| R2   | 2.7kΩ         | 1 |
| R3   | 300Ω          | 1 |
| T1   | 端子台 2P      | 1 |
| T2   | XH ポスト 2P   | 1 |
| U1   | PIC12F1501     | 1 |

配線部品

| 品目 | 個数 |
| ---  | ---  |
| ケーブル | 適量 |
| ニチフ TCー1.25 | 2 |
| ピンジャック    | 2 |
| フェルール端子  | 4 |
| XH ハウジング 2P | 1 |
| XH コンタクト    | 2 |

[ソース](./src/v2.0_pic12f1501/main.c)

![完成](./photos/v2.0.jpg)

反省点。

MOS は逆流はできるので、PIC に電池を繋いだだけで電源に 2.5V くらいが供給されて電源が入って
しまう。NiMH の時はたまたま PIC の動作電圧以下だったから問題にならなかっただけのようだ。そ
して ADC には VCC よりも大きな値が入って駄目になる。仕方ないので起動を 10秒待つことにした。

1. 電池は外す
2. 電源入れる
3. 10秒以内に電池を繋ぐ

2A くらい流せるフォトリレーを使う方が良いのかも知れない。
