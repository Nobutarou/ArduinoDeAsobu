# コンデンサ静電容量測定

## 考えたり、やってみたこと

参考にしているのはこちら。

https://101010.fun/iot/arduino-measure-capacitance.html

参考サイトの計測終了後の放電のギミックは、電力供給ピン D2 を GND接続、放電ピン D3 も GND接
続にして、両方から放電している。サイトでは D3 から放電と言ってるが、厳密には違う。 

まあ面倒なので放電は 100% D3 から行われるものと仮定して考える。

放電に関しては、こちらで計算できる。

https://www.digikey.jp/ja/resources/conversion-calculators/conversion-calculator-capacitor-safety-discharge

Arduino Uno R3 のデジタルピンは 40mA まで吸える。ということは上記サイトで初期電力が 5V x
40mA = 0.2W までなら、大丈夫ということである。

時定数はこちらのサイトで計算できる。

https://www.digikey.jp/ja/resources/conversion-calculators/conversion-calculator-time-constant

Arduino の ADC はデフォルトで 16MHz/128 での駆動。ADC 一回の動作に 13 サイクル掛かるので、
ADC 1回のループは、1/(16MHz/128)x13 で約 1.0e-4 sec である。しかし ADCSRA レジスタの ADPS
ビットでこの分周比は、仕様上 2 まで小くできる。しかし、テストしたところ、分周比 2 では最初
に何の理由か不明だが1023 と読み取ってしまい、時定数が 0 になってしまった。そのため、実際に
利用できる下限は 4である。

分周比 4 だと 1/(16MHz/4)x13 で約 3.3e-6 sec となる。したがって、時定数は、1e-3 sec あたり
を越えておけば、まずまずの計測ができるだろう。

## ソース、配線図

![ソース](./arduino/main/main.ino)

![配線図](./kicad/CapacityMeasure/静電容量測定配線図.png)

## テスト

|公称静電容量<br>[F]|R1<br>[Ω]|時定数<br>[s]|測定値<br>[F]|補足|
| ---  | --- | ---    | ---   | ---     |
| 0.1u | 10k | 1.00e-3| 0.10u | フィルム|
| 0.1u | 10k | 1.00e-3| 0.14u | セラミック |
| 0.01u| 10k | 1.00e-4| 0.011u| セラミック |
| 22p  | 10k | 2.20e-7| 851p  | セラミック |

おおよそ期待どおりの試験結果かな。

## 静電容量ごとの抵抗選択


|静電容量<br>[F]|R1<br>[Ω]|R2<br>[Ω]|時定数<br>[s]|放電直後の電力消費<br>[W]|1e-2Vまでの放電時間<br>[s]|
|---------------|----------|----------|-------- |-------------------------|-----------|
| 0.01u         | 100k     | 10k      | 1.00e-3 | 2.5e-3 | 6.2e-4 |
| 0.1u          | 100k     | 10k      | 1.00e-2 | 2.5e-3 | 6.2e-3 |
| 100u          | 300      | 300      | 3.00e-2 | 8.3e-2 | 0.19   |
| 22p           | 100M     | 10k      | 2.20e-3 | 2.5e-3 | 1.37e-6 |

10k と 300Ωは手持ちなので優先。
