# 抵抗計

# version 1.0 没

静電容量計が思いの他便利だったので、

[静電容量計](./../CondenserMeasure/抵抗自動選択式の開発.md)

抵抗計も作ってみることにした。とてもじゃないけどカラー
コードを覚えられないし、毎回カラーコードを読むのも老眼にはつらい。

原理は、単純に直列して、電圧を測定して、抵抗を逆算するだけ。

VCC - R0 - R1 - GND で R1-GND の電圧を V1 とすれば

V1/VCC = R1/(R0+R1)

... R1 = R0 V1 / (VCC - V1 )

a を 8ビット DAC の読取値とすると

a = V1/VCC * 1023

... V1 = a VCC / 1023

... R1 = R0 a / (1023-a)

となる。

8ビット ADC なので、上下 100ずつを除いた範囲で利用することを考えると、手持ちの抵抗では次の
ようになる。

| R0 [Ω] | R1 [Ω] | a |
| ---     | ---     | --- |
| 300     | 47      | 139 |
| 300     | 2.2k    | 900 |
| 22k     | 4.7k    | 180 |
| 22k     | 100k    | 839 |
| 1M      | 220k    | 184 |
| 1M      | 4.7M    | 844 |

MΩなんて静電容量計でしか使わないので、まあ十分だろう。

## 回路図

こちら

[回路図 v1.0](./kicad/RegisterMeter_1.0/RegisterMeter_1.0.pdf)

| Reference | Value      | 数量 | 
| --------- | ---------- | ---- | 
| R1        | 300        | 1    | 
| R2        | 22k        | 1    | 
| R3        | 1M         | 1    | 
| R4        | R          | 1    | 
| U1        | ATmega328P | 1    | 

ピンの選択は ASOBoard 用シールドに都合の良いものを選んだ。応答速度はのんびりで良いのでレジ
スタ操作の都合は考えなくて良い。

## ブレボでテスト

以下の抵抗をテストした結果。まずまずだけど 300Ωを参照した場合の結果がいまいち、やたらと低
い。

| テストした抵抗 [Ω] | 結果 [Ω] |
| --------------      | -------   |
| 2k                  | 1.89k     |
| 100M                | 92M       |
| 300                 | 278       |
| 75                  | 69        |
| 210k                | 206k      |
| 600                 | 560       |
| 100k                | 100k      |
| 3k                  | 2.92k     |

300Ω で 75Ωを測定しているときに D2 を A4 に差してみたところ analogRead() は 966 となった。
1023 からかなり下っている。

これだな。出力ピンの電圧も測って、その比率とする必要があるな。

ていうか、これだと静電容量計も 300Ωを使う結果はかなり怪しそうだな。まあ大きなコンデンサは
容量が数字でプリントしてあるから、故障だけ判断できれば良いんだけど。

# ver 1.1

v1.0 を改良。

## 回路図

PDF はこちら

[回路図 1.1](./kicad/RegisterMeter_1.1/RegisterMeter_1.1.pdf)

| Reference | Value      | 数量 | 
| --------- | ---------- | ---- | 
| R1        | 300        | 1    | 
| R2        | 22k        | 1    | 
| R3        | 1M         | 1    | 
| R4        | R          | 1    | 
| U1        | ATmega328P | 1    | 

## ソース

[ソース 1.1](./arduino/RegisterMeter_1.1/RegisterMeter_1.1.ino)

## テスト結果

| テストした抵抗 [Ω] | 結果 [Ω] |
| --------------      | -------   |
| 2k                  | 2.0k      |
| 100M                | 112M      |
| 300                 | 296       |
| 75                  | 79        |
| 210k                | 206k      |
| 600                 | 600       |
| 100k                | 100k      |
| 3k                  | 2.9k      |

なかなか良好だけど、実は一つ良く分からずに苦労したところがあった。100MΩ以外からの給電のと
きは analogRead を出力ピン電圧、測定対象抵抗電圧の順番で問題がないのだけど、100MΩのときだ
け、順番を逆にしないと、測定対象の抵抗の電圧の値がおかしくなってしまう。

というか、もう電圧の降下はないから、わざわざ測るのをやめることにした。

一応自分を納得させるための解釈としては、普通は回路とマイコンだとマイコンの抵抗が十分に大き
いので、回路から余計な電荷が流れ困なかったり、利用した電荷を回路に返したりできるのだけど、
回路の抵抗が大きくなってくると、回路から余計な電荷が来てしまったり、返そうとしても返せなく
て、マイコン内の行きやすいところに行ってしまう。そのように自分を納得させることにした。
