# データシート

https://aitendo3.sakura.ne.jp/aitendo_data/product_img/ic/inteface/GL850G/GL850G-HHY22.PDF

# 参考回路

参考回路 A:

https://github.com/llegoff/USB_Hub

実物写真があるので、動く物である可能性が高いので、これを一番優先と考える。

参考回路 B:

https://github.com/RyanDam/TinyUSBHub

参考回路 C:

https://github.com/veis-lzf/GL850G-USB2.0-HUB

# 挑戦 1.0

## ピンの把握

まず、各ピンの配線を見ていく。

### PREF

Table 3.4 によると 680Ω抵抗を介して GND につなぐ。正確には analog ground と買いてあるが、
参考回路は GND は全部共通としてるので GND で良いのだろう。

なんとなく 3.3V レギュレータに使う抵抗の気がするのだけど、これ IC に内蔵できなかったのだろ
うか。

ちなみに MA8601 のときは、この手の情報がデータシートに全くなかった。

### OVCUR1#

Table 3.4 によると Low とすると過電流を検知ということになる。電流チェック用の IC を使って
電流チェックする予定はないので、つねに High にしておけば良いはずだ。

参考回路 A は OVCUR1# を抵抗を使って 5V を 3.3V に落として入力している。このピンは 5V 耐圧
なので、5V そのままでも良さそうだが、わざわざ落としている。参考 B, C も 3.3V としている。
IC が 3.3V なら、耐圧 5V と書いてあっても 3.3V に落とすのが一般的なのだろうか。ちなみに
Table 6.3 によると 2V で High 判定となるようだ。また Table 6.2 によると定格運用範囲は 5.0V
までのようだ。そうなると誤差を考えると 5V そのまま入力するのは、動作が怪しくなるかもしれな
い。適当に確実に 5V より小くしておくのが無難ということで 3.3V で良いのだろう。

一つ疑問なのはレギュレータが 3.3V を V33 ピンに出力するので、それを入れたら良いのではない
かというところ。

ということで、次のテストはしてみたい。

- 適当に 3.3V ではないが、確実に 5.0V 以下にしたものを入力しても動くのか
- V33 ピンから直接入れたら動くのか

### OVCUR2#

どの参考回路も未使用となっている。

結論から行くと、ギャングモード (過電流をハブ合計で監視する方法) では OVCUR#1 のみ使用すれ
ば良いからである。そして参考回路はすべて PGANG に High を入力することで ギャングモードとな
っている。なので入力しなくて良いのである。

### PWREN1#, 2#

どの参考回路でも未使用。電力が来てるかどうかの出力ピンなので、使う必要はない。

### PSELF

High でセルフパワー、Low でバスパワー。電流管理を始めからしていないので、どっちでも良いは
ず。

参考回路 A, B は 10kΩを介して High としている (回路自体はバスパワーである)。参考回路 C は
未使用だが、それで良いのか？

ということで、次のテストはしてみた。

- PSELF を未使用として動作するのか

### PGANG

起動時に High にしておくとギャングモードとなる。もちろん電流管理をしないので、どうでも良い
はずではある。ただしギャングモードにしておくと OVCUR2# ピンを未使用にできる。

全ての参考回路でギャングモードは High に設定されている。5.2.2節によるとプルアップ抵抗は
100kΩが指定されている。

## RESET#

起動時に 10kΩでプルアップするように指定。Table 6.2 によると OVCUR1# と定格運用電圧上限は
同じ 5.0V なのに、参考回路 A では 5V にそのままプルアップしている。Table 6.1 によると 5.5V
までは壊れないけど、動作範囲に収めるべきなのでは？？？

一方、参考回路 C では抵抗を使って 4.1V の入力としている。

OVCUR#1 をわざわざ 3.3V に落とすんだから、こちらも、参考回路 C のように少しは落としたい。

また、一方でコンデンサを介して GND にもつないである。これは 5.2.1 節が関係していると思う。
リセットピンは VDD がしっかり立ち上がったあと 3usec 以上の時刻を掛けて High にならないとい
けない。参考回路 A は 1uF、B と C は 0.1uF となっている。10kΩ抵抗と直列なので時定数は
0.01s ~ 0.001s となる。しっかり計算していないが 3us より 3桁大きいので十分だろう。またフィ
ルター目的ではないのでセラコンでも電解コンでも良いはずだ。

次のことは試したい

- 0.1uF, 1uF どちらでも動くのか
- セラコン、電解コン、どちらでも動くか
- 内蔵レギュレータ 3.3V へのプルアップで動くか

### TEST

参考回路 A, B はプルダウンしているが、Table 3.4 によると Internal pull down なので回路 C
のように、未使用で良いはずである。

次のことは試したい。

- 未使用で問題ないか

### AVDD

IC 用 3.3V 入力ピン。回路 A, B では C 0.1uF を 3個、回路 C では 4個並列している。パスコン
だと思うが、同じ容量を 3, 4個並べて意味があるのだろうか。3, 4 個付けるなら、0.01uF, 0.1uF,
1uF という感じでずらす方が、幅広い周波数帯に効くのではないだろうか。

ということで次のことを試したい。

- 0.1uF 一つで良くね？
- 0.01uF, 0.1uF, 1uF で良くね？
- 1uF は電解コンで良い？
