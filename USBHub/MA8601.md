# Prolific MA8601 での USB ハブ作りに挑戦

台湾 Prolific 製の MA8601 での挑戦。なぜか本家 Prolific 社ではデータシートが見つけられない。

https://www.prolific.com.tw/US/index.aspx

aitendo が掲載してるこちらは、なんか文字などのベクトルデータじゃなくて、ただの画像になって
おり、小さい文字が見えない。しかしググっても、これか、古いのしか出てこないので、これでいく。

https://x.gd/MUwJt

データシートに Application circuit とか Typical schematics とか載ってないので、有志の情報
を参考にする。

バスパワーでの例はここ。便宜上、参考回路A と呼ぶ。

https://x.gd/IfCxX

バス or セルフパワーの例はここ。便宜上、参考回路B と呼ぶ。こちらはなぜか、いくつかの回路の

https://blog.51cto.com/u_15439680/5364272

こちらは兄弟チップと思われる FE1.1s での例で、バス or セルフパワーをやはり雑に選べる回路と
なっている。便宜上、参考回路C と呼ぶ。

https://x.gd/oG5fF

## 方針 v1.0

- バス & セルフパワー
- 切り替えは手動
- LED 要らない。チェック端子くらいなら付けておいても良いかも。スペースと相談。

## 回路図 v1.0

### 水晶につけるコンデンサ

参考回路A にはコンデンサが付いてなくて、参考回路B には付いている。なのであまり参考にできな
い。

こちらの考え方、``Ce+Ci=2CL-Cs`` で ``Ci=0`` として ``Ce=2CL-Cs`` としている。

https://forum.digikey.com/t/topic/6738

一般的な ATmega328P の 16MHz + 22pF の組合せを考える。秋月の ATmega328P 開発ボードには、こ
の Mercury HUSG-16.000-20 が付いており、CL=20pF とある。記事のように Cs=5pF とすると、
35pF となり 22pF に対して過大である。

ATmega328P のデータシートを見ると Ci は最大 10pF とある。これを考慮すると Ce=25pF となり
22pF に近づく。

なおこちらの記事によると ``Ce=2CL-2Cs`` と Cs を 2倍する必要がある。しかしこれは Ci が消え
ている。まあただ、こちらの 2Cs が先の Cs+Ci 相当になってるだけだろう。

https://blog.adafruit.com/2012/01/24/choosing-the-right-crystal-and-caps-for-your-design/

では Ci+Cs=18pF として考えて見よう。

付けようとしているクリスタルは、九州電通の HC-49/S3-12MHZ で CL=16pF とある。

http://kdk-group.co.jp/datasheet/hc49s3_hc49ss.html

同じ Cs=18pF で考えると CL=14pF となり、参考回路B の 20pF に程近い感じだ。ということで
14-20pF あたりを探してみよう。

ここあたりを見ると、負荷容量は倍半分でも全然動くみたいだ。ppm というのは 1/1e6 の精度のよ
うだから、正直動けばどうでも良いレベルだ。

https://www.tamadevice.co.jp/unit-load-cap.htm

あと何も付けてない回路図では何も付けずに動いているのかもしれない。Cs>=CL であるならば付け
る必要がないからだ。

### PSELF, PWRJ, OVCJ の電源関連の考察

参考回路A は PSELF, PWRJ, OVCJ が全部浮いている。これは電源管理は何もしないということと考
えられる。

参考回路B は PSELF は不明だが、おそらく high と思うので high と仮定する。OVCJ は電源スイッ
チIC から受けとる信号で、制限内なら high、制限超えると low が来る。low が来たら PWRJ が
high を出し、電源 IC が動作を止める。

PSELF の働きがデータシートに当然載ってないので不明だけど、これはどう考えても直接電流を制御
するものではないから、上流、下流にここはセルフパワーですよ、と伝達するためのものなのかも知
れない。

参考回路C は PSELF=OVCJ=high だが PWRJ は浮かしている。

自分の方針は PSELF は high, low の選択式で浮かさない。OVCJ は常時 high。PWRJ は浮かしてお
くことにする。



