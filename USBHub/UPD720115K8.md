# v1.0
## ピンの研究

[マニュアル](https://www.renesas.com/ja/document/mah/upd720115-4-port-usb-20-hub-controller-hardware-users-manual?r=1260486)

[参考回路](https://www.renesas.com/ja/document/pcs/rtka720115de0000bu-4-port-usb-20-hub-design-files?r=1260486)

前提条件
- 電源は USB のみ
- バスパワーだけど、ATX 常時電源に繋がってるのでそこそそ電流は流れるからセルフパワーのふりをする
- ギャングモード。電流管理は適当にヒューズ。
- 内蔵 LDO を使う
- LED は光らせない
- 充電機能は最初の挑戦ではやめておく。

| 番号 | 名称 | コメント |
| --- | --- | --- |
| 1 | OCI1B | 1で許容電流の状態なので 3.3V に接続。5V からの分圧 3.3V を繋いでいるが、電源は USB しかないから 3.3V LDO の出力でも良いはず。入力のみのピンなので抵抗不要のはず |
| 2 | LPWRM | 1 でセルフパワーモードなので 3.3V に接続。ATX の常時電源に繋がってるから。入力ピンなので直結で良いはず。 |
| 3 | VBUSM | USB 電源が来たかの判定で分圧 3.3V を入れているが、電源は USB しかない前提なので 3.3V LDO 出力で良いはず。入力ピンなので直結で良いはず |
| 4 | VDD50IN | 内蔵 3.3V LDO への 5V 入力。5V 入力はここだけで、5V には 0.1uF と 4.7uF がいくつか入っている |
| 5 | VDD33OUT | 内蔵 3.3V LDO 出力。0.1uF と 4.7uF がいくつか入っている |
| 6 | VDD33IN | 内蔵 1.05V LDO への入力。VDD33OUT に繋ぐ |
| 7 | VDD10OUT | 内蔵 1.05V LDO の出力。0.1uF と 4.7uF がお決まりのようにいくつか入っている |
| 8 | LED1B | 1 で LED としての利用なのでプルアップ。I/O ピンで何か間違って出力されるのが恐いので抵抗を入れる |
| 9 | PPON2B | ギャングモードを指定するのでプルダウン。I/O ピンなので抵抗入れる|
| 10 | OCI2B | OC って Over Current の略のようだ。ギャングモードでは利用しないが、うっかり 0 が入ると取り外し不可となるので、プルアップしておく。入力ピンなので直結|
| 11 | LED2B | 浮かす |
| 12 | PPON3B | 4ポート使うので 1。プルアップ。I/O なので抵抗入り |
| 13 | OCI3B | ギャングモードでは使用しないが、うっかり 0 で取り外し不可なので、プルアップ。入力ピンなので直結 |
| 14 | VDD33 | 3.3V 供給なので VDD33OUT に繋ぐ |
| 15 | LED3B | 浮かす |
| 16 | PPON4B | 4ポート使うので 1 のプルアップ。I/O ピンなので抵抗入れる |
| 17 | OCI4B | ギャングモードなので使用しないが、0 で取り外し不可になるので プルアップ。入力ピンなので直結 |
| 18 | LED4B | 浮かす |
| 19 | RESETB | 抵抗とコンデンサでリセットを少し遅らせている。多分 OCI, PPON, LED 等の機能設定ピンに先に電圧を掛けるためだと思う。この組合せだと 1 判定の 2V 到達に 10ms でこれは表 3-10 の最小だから、多少遅くても良いはず。ダイオードは電源オフ時の放電を瞬時にするため?分からないけどダイオードは付けておく。1SS294 はショットキーのようだ (＊1)|
| 20 | VDD10 | 1.05V 供給なので VDD10OUT に繋ぐ |
| 21 | DM4 | |
| 22 | DP4 | |
| 23 | DM3 | | 
| 24 | DP3 | |
| 25 | VDD33 | VDD33OUT へ |
| 26 | DM2 | |
| 27 | DP2 | |
| 28 | DM1 | |
| 29 | DP1 | |
| 30 | PPON1B | 出力ピンであり、自分の使い方では VBUS on で 0、off で高インピーダンス。参考回路のプルアップは、高インピーダンスでうっかり 0 と検知されないためだと思う。監視しないので、未使用で OK なはず |
| 31 | VDD33 | VDD33OUT へ |
| 32 | XT2 | 24MHz 水晶 |
| 33 | XT1 | 24MHz 水晶 |
| 34 | IC | テストピンで GND へ。入力なので直結 |
| 35 | RREF | 1% 精度の 1.6kΩを GND へ |
| 36 | AVDD33 | VDD33OUT へ。フェライトビーズはスペースに余裕があれば付けよう。 |
| 37 | VDD10 | VDD10OUT へ |
| 38 | DMU | 上流側の D- |
| 39 | DPU | 上流 D+ |
| 40 | VDD33 | VDD33OUT へ |

[＊1](https://tinyurl.com/2d5wulty)

[回路図](./UPD720115K8/1.0/UPD720115K8_1.0/UPD720115K8_1.0.pdf)

[設計図](./UPD720115K8/1.0/UPD720115K8_v1.0.pdf)

部品表

| 図面記号   | 品番、品目             | 個数 |
| ---        | ---                    | --- |
| A1,2       |  USB-A 二段コネクタ    | 2 |
| B1         |  ユニバーサル基板 15x19| 1 |
| B2         |  ユニバーサル基板 8x13P| 1 |
| C1-3       |  0.22uF                | 3 |
| C4         |  3.3uF                 | 1 |
| C5-7       |  1.5uF                 | 3 |
| C8-9       |  16pF                  | 2 |
| D1         |  ショットキーダイオード| 1 |
| F1         |  ヒューズ              | 1 |
| H1,2       |  ピンヘッダ 13P        | 2 |
| J1 |  USB-B コネクタ| 1 |
| R1-5 |  10kΩ| 5 |
| R6 |  1.6kΩ ±1%| 1 |
| S1,2 |  ピンソケット 13P| 2 |
| U1 |  UPD720115K8| 1 |
| Y1 |  水晶 24MHz| 1 |

[参考動画](https://www.nicovideo.jp/watch/sm22265444)

無理。まずランドが小さすぎて、はんだが上手く載らない。実はこれが一番キツい。配線は、全然き
れいに出きないけど、美しさを諦めて長めに切ってやれば、なんとか取り回せる。こて先をちょんと
当てるのも、T 型で、端の方を使う感じでなんとかなる。でも、そもそもはんだの載りが少なすぎて、
ちょんとできても、ひっつかない。

再度挑戦。やはりチップへの予備はんだが最大の難関。ワイヤーの位置決めと、こて先のちょんは、
顕微鏡を覗きながらやれば、なんとかできる。しかし、予備はんだがしっかり載ってないと、いくら
位置決めとちょんが上手くやれても、ひっつかない。難しい。

動画の方は QFN はブリッジしないから簡単と言っているが、ブリッジしないということは、はんだ
をこんもりたくさん載せるのも難しいということなんだと思う。
